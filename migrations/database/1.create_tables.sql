BEGIN;

DROP TABLE IF EXISTS "card",
"paper",
"comment",
"label",
"media",
"organization",
"member",
"media_has_label";


CREATE TABLE "member" (
"id" INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"pseudo" TEXT NOT NULL,
"email" TEXT NOT NULL,
"password" TEXT NOT NULL,
"role" TEXT NOT NULL
);

CREATE TABLE "paper" (
"id" INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"url" TEXT NOT NULL,
"title" TEXT NOT NULL,
"description" TEXT,
"create_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
"update_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE "card" (
"id" INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"author" TEXT NOT NULL,
"description" TEXT NOT NULL,
"url" TEXT NOT NULL,
"type" TEXT NOT NULL,
"member_id" INT NOT NULL REFERENCES "member"("id"),
"create_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
"update_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "comment" (
"id" INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"member_id" INT NOT NULL REFERENCES "member"("id"),
"author" TEXT NOT NULL,
"card_id" INT NOT NULL REFERENCES "card"("id"),
"content" TEXT NOT NULL,
"create_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
"update_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "media" (
"id" INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"type" TEXT NOT NULL,
"url" TEXT NOT NULL,
"member_id" INT NOT NULL REFERENCES "member"("id"),
"card_id" INT NOT NULL REFERENCES "card"("id"),
"create_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
"update_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE "label" (
"id" INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"content" TEXT NOT NULL,
"media_id" INT NOT NULL REFERENCES "media"("id")
);


CREATE TABLE "organization" (
"id" INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"name" TEXT NOT NULL,
"member_id" INT NOT NULL REFERENCES "member"("id")
);

CREATE TABLE "media_has_label"(
"id" INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"media_id" INT NOT NULL REFERENCES "media"("id"),
"label_id" INT NOT NULL REFERENCES "label"("id")
);


COMMIT;